---
import { t, getNavItems, getAlternatePath } from "../i18n/utils";
import type { Locale } from "../i18n/utils";

interface Props {
  locale?: Locale;
}

const locale: Locale = Astro.props.locale ?? "de";
const navItems = getNavItems(locale);
const currentPath = Astro.url.pathname;
const targetLocale = locale === "de" ? "en" : "de";
const switchPath = getAlternatePath(Astro.url, targetLocale);
const switchLabel = t(locale, "langSwitch");
const homeHref = locale === "en" ? "/en/" : "/";
---

<header class="py-4 px-4 md:px-8 sticky top-0 z-50 bg-cream/90 backdrop-blur-sm">
    <nav
        class="max-w-6xl mx-auto flex flex-col md:flex-row md:items-center md:justify-between gap-4"
    >
        <a
            href={homeHref}
            class="flex items-center gap-3 hover:opacity-80 transition-opacity"
        >
            <img
                src="/images/KINDERHAUS_LOGO_QUEER.svg"
                alt="Montessori-Kinderhaus Logo"
                class="h-16 md:h-20 w-auto"
            />
        </a>

        <div class="md:hidden absolute top-6 right-4 flex items-center gap-3">
            <button
                id="mobile-menu-button"
                class="p-2"
                aria-label={t(locale, "nav.menuOpen")}
                aria-expanded="false"
            >
                <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            <a
                href={switchPath}
                class="text-sm font-medium border border-text/20 px-3 py-1 rounded-full hover:bg-yellow/20 transition-colors"
            >
                {switchLabel}
            </a>
        </div>

        <ul
            id="nav-menu"
            class="hidden md:flex flex-col md:flex-row gap-2 md:gap-8 text-md items-center"
        >
            {
                navItems.map((item) => (
                    <li>
                        <a
                            href={item.href}
                            class:list={[
                                "block py-2 md:py-0 transition-colors hover:text-yellow-dark",
                                currentPath === item.href
                                    ? "text-yellow-dark"
                                    : "text-text-muted",
                            ]}
                        >
                            {item.label}
                        </a>
                    </li>
                ))
            }
            <li class="hidden md:block">
                <a
                    href={switchPath}
                    class="block py-2 md:py-0 text-sm font-medium border border-text/20 px-3 py-1 rounded-full hover:bg-yellow/20 transition-colors"
                >
                    {switchLabel}
                </a>
            </li>
        </ul>
    </nav>
</header>

<script>
    const button = document.getElementById("mobile-menu-button");
    const menu = document.getElementById("nav-menu");

    button?.addEventListener("click", () => {
        const isExpanded = button.getAttribute("aria-expanded") === "true";
        button.setAttribute("aria-expanded", (!isExpanded).toString());
        menu?.classList.toggle("hidden");
    });
</script>
